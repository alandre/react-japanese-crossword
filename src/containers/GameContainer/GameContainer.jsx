import React, { Component } from 'react';
import clone from 'clone';

import GameComponent from '../../components/GameComponent/GameComponent';

import { parse, solve, solveStepByStep } from '../../solver/index';

const __DEBUG_GAME_STRING__ = 'v2#64,75,6,6#000000#1|7,1|2,5,1,6|2,2,3|4,1,2|5,1,2,1|6,3,2|8,5,1|9,5,2|10,7|1,20|2,22|2,24|2,25|30|34|33|3,30|3,3,26|4,1,3,24|4,1,5,6,15|4,2,6,9,11|3,1,17,9|4,2,17,8|4,1,19,7|5,2,20,8|4,1,21,4,2|4,2,26,3|4,1,25,4|4,1,11,14,5|5,2,15,10,5|5,1,17,8,5|5,2,19,5,6|6,1,23,4,7|6,28,3,8|6,3,26,1,9|6,4,26,10|7,1,3,24,11|8,2,5,23,12|7,2,7,22,12,4|7,1,9,21,6,11|7,2,11,21,4,5|6,2,34,3,6|6,2,20,5,1,5|5,2,18,3,7|5,3,17,1,9|5,2,11,2,30|5,2,5,3,36|4,7,38|3,47|51|50|50|48|47|47|45|43,7,6|42,11,13|75|75|75|75|75|#15,5|19,5|21,5|15,14|15,14|13,16|12,19|10,21|9,5,16|9,5,16|7,5,18|6,3,22|6,16,15|7,3,1,12,15|1,6,4,3,11,15|7,3,3,9,15|6,3,4,9,16|4,3,6,25|1,5,4,7,25|3,8,9,24|3,2,9,11,7,16|4,6,20,5,17|14,21,5,17|14,21,4,17|14,26,17|14,43|18,42|3,39,17|3,38,17|2,36,18|2,21,14,18|2,1,34,18|1,3,10,22,18|1,14,9,12,18|1,24,11,18|24,10,18|14,9,10,18|13,9,9,18|13,8,9,18|14,9,8,18|3,13,9,8,18|3,14,9,8,18|3,15,18,18|3,24,26|2,20,4,18|1,15,12,5|1,13,11,5|1,11,10,5|13,8,6|6,7,6|6,5,7|7,4,7|8,3,7|8,4,7|8,3,7|9,3,7|9,3,7|10,3,6|9,3,6|11,5|6,2,5|4,3,5|4,2,6|4,3,6|3,2,7|3,2,7|4,7|3,7|3,7|2,7|2,6|2,6|2,6|1,6|1,6|#0|0,0|0,0,0,0|0,0,0|0,0,0|0,0,0,0|0,0,0|0,0,0|0,0,0|0,0|0,0|0,0|0,0|0,0|0|0|0|0,0|0,0,0|0,0,0,0|0,0,0,0,0|0,0,0,0,0|0,0,0,0|0,0,0,0|0,0,0,0|0,0,0,0|0,0,0,0,0|0,0,0,0|0,0,0,0|0,0,0,0,0|0,0,0,0,0|0,0,0,0,0|0,0,0,0,0|0,0,0,0,0|0,0,0,0|0,0,0,0,0|0,0,0,0|0,0,0,0,0|0,0,0,0,0|0,0,0,0,0,0|0,0,0,0,0,0|0,0,0,0,0,0|0,0,0,0,0|0,0,0,0,0,0|0,0,0,0,0|0,0,0,0,0|0,0,0,0,0|0,0,0,0,0|0,0,0|0,0|0|0|0|0|0|0|0|0,0,0|0,0,0|0|0|0|0|0|#0,0|0,0|0,0|0,0|0,0|0,0|0,0|0,0|0,0,0|0,0,0|0,0,0|0,0,0|0,0,0|0,0,0,0,0|0,0,0,0,0,0|0,0,0,0,0|0,0,0,0,0|0,0,0,0|0,0,0,0,0|0,0,0,0|0,0,0,0,0,0|0,0,0,0,0|0,0,0,0|0,0,0,0|0,0,0|0,0|0,0|0,0,0|0,0,0|0,0,0|0,0,0,0|0,0,0,0|0,0,0,0,0|0,0,0,0,0|0,0,0,0|0,0,0|0,0,0,0|0,0,0,0|0,0,0,0|0,0,0,0|0,0,0,0,0|0,0,0,0,0|0,0,0,0|0,0,0|0,0,0,0|0,0,0,0|0,0,0,0|0,0,0,0|0,0,0|0,0,0|0,0,0|0,0,0|0,0,0|0,0,0|0,0,0|0,0,0|0,0,0|0,0,0|0,0,0|0,0|0,0,0|0,0,0|0,0,0|0,0,0|0,0,0|0,0,0|0,0|0,0|0,0|0,0|0,0|0,0|0,0|0,0|0,0|';

class GameContainer extends Component {
  constructor(props) {
    super(props);

    this.state = {
      field: [[]],
      left: [[]],
      top: [[]],
      solved: false
    };
  }

  componentDidMount() {
    const game = parse(__DEBUG_GAME_STRING__);
    this.solver = solveStepByStep(clone(game));
    this.setState(game);
  }

  nextStep = () => {
    if (this.state.solved) {
      return;
    }

    this.setState(this.solver.next(clone(this.state)).value);
  };

  render() {
    return (
      <GameComponent
        {...this.state}
        onNextStepClick={this.nextStep}
      />
    );
  }
}

export default GameContainer;
